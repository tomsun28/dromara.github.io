<!doctype html><html><head><title>SpringCloud User · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=wwads-cn-verify content=8d5e957f297893487bd98fa830fa6413><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?a02cb5c75097762223d5a815a03e0a15";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><script type=text/javascript src=https://cdn.wwads.cn/js/makemoney.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/><img class=logo src=/img/logo/dromara.jpg></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/community/><span>Community</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/projects/myth/springcloud-user/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/projects/>Projects</a>
<a class=navbar-item href=/blog/>Blog</a>
<a class=navbar-item href=/activities/>Activity</a>
<a class=navbar-item href=/community/>Community</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/zh/projects/myth/springcloud-user/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="Myth is based on a distributed transaction framework that is ultimately consistent with reliable messaging.">Myth<div class="ss-toc-list-card -hidden-mobile"><svg class="icon -hidden-mobile" aria-hidden="true"><use xlink:href="#icon-menu1"/></svg><div class=ss-tooltip><div class=toc-list><h4 class=title>Distributed Transaction</h4><ul class=list><li class=item><a href=/projects/hmily/overview>Hmily</a></li><li class=item><a href=/projects/raincat/overview>Raincat</a></li><li class=item><a href=/projects/myth/overview>Myth</a></li></ul></div><div class=toc-list><h4 class=title>Popular Tools</h4><ul class=list><li class=item><a href=https://hutool.cn/>Hutool</a></li><li class=item><a href=http://forest.dtflyx.com/>Forest</a></li><li class=item><a href=https://yomahub.com/liteflow/>Liteflow</a></li><li class=item><a href=https://juejin.cn/column/7053801521502224392>dynamic-tp</a></li><li class=item><a href=https://easy-es.cn>Easy-Es</a></li><li class=item><a href=http://www.mtruning.club:81/>GoView</a></li><li class=item><a href=http://dromara.gitee.io/image-combiner>ImageCombiner</a></li><li class=item><a href=/projects/jinx/overview>Jinx</a></li><li class=item><a href=https://gitee.com/dromara/northstar/wikis/pages>Northstar</a></li><li class=item><a href=https://dromara.org/fast-request>FastRequest</a></li></ul></div><div class=toc-list><h4 class=title>Enterprise Certification</h4><ul class=list><li class=item><a href=http://sa-token.dev33.cn>SaToken</a></li><li class=item><a href=https://maxkey.top/>MaxKey</a></li><li class=item><a href=https://dromara.org/sureness>Sureness</a></li></ul></div><div class=toc-list><h4 class=title>Operations and Maintenance Control</h4><ul class=list><li class=item><a href=https://jpom.io/>Jpom</a></li><li class=item><a href=https://hertzbeat.com>HertzBeat</a></li></ul></div><div class=toc-list><h4 class=title>Distributed Log</h4><ul class=list><li class=item><a href=https://yomahub.com/tlog/>TLog</a></li></ul></div><div class=toc-list><h4 class=title>Agent Monitoring</h4><ul class=list><li class=item><a href=https://cubic.jiagoujishu.com/>Cubic</a></li><li class=item><a href=/projects/athena/overview>Athena</a></li></ul></div><div class=toc-list><h4 class=title>Microservice</h4><ul class=list><li class=item><a href=https://github.com/dromara/koalas-rpc>KoalasRpc</a></li><li class=item><a href=https://www.jeesuite.com/>Mendmix</a></li><li class=item><a href=https://www.herodotus.cn>dante-cloud</a></li></ul></div><div class=toc-list><h4 class=title>Distributed Scheduling</h4><ul class=list><li class=item><a href=/projects/hodor/overview>Hodor</a></li></ul></div></div></div></div><div class=body><ul class=leaf-section><li class=item><div class=link><a title=Introduction href=/projects/myth/overview>Introduction</a></div></li><li class=item><div class=link><a title=configuration href=/projects/myth/config>configuration</a></div></li><li class=item><div class=link><a title="start myth-admin" href=/projects/myth/start-myth-admin>start myth-admin</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=document>document</a></div><ul class=leaf-section><li class=item><div class=link><a title="dubbo user" href=/projects/myth/dubbo-user>dubbo user</a></div></li><li class=item><div class=link><a title="motan user" href=/projects/myth/motan-user>motan user</a></div></li><li class=item><div class="link -current"><a title="springcloud user" href=/projects/myth/springcloud-user>springcloud user</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="quick start">quick start</a></div><ul class=leaf-section><li class=item><div class=link><a title=quick-start-dubbo href=/projects/myth/quick-start-dubbo>quick-start-dubbo</a></div></li><li class=item><div class=link><a title=quick-start-motan href=/projects/myth/quick-start-motan>quick-start-motan</a></div></li><li class=item><div class=link><a title=quick-start-springcloud href=/projects/myth/quick-start-springcloud>quick-start-springcloud</a></div></li></ul></li></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>SpringCloud User</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/dromara.github.io/edit/master/content/en/projects/myth/springcloud-user/index.md>Edit</a></div><div class=meta>Update time: 2022-09-12</div></div><article class=typo><ul><li><p>In the springcloud service provider (the participating method of the transaction, the called party).</p><ul><li><p>add myth-springcloud dependency</p><pre><code class=language-xml>  &lt;dependency&gt;
      &lt;groupId&gt;com.github.myth&lt;/groupId&gt;
      &lt;artifactId&gt;myth-springcloud&lt;/artifactId&gt;
  &lt;/dependency&gt;
</code></pre><ul><li>Configure MythTransactionBootstrap to start the class, either as XML or as @Bean. Specific configuration can refer to here:<a href=https://github.com/yu199195/myth/wiki/Configuration>configuration for details</a>.</li></ul><pre><code class=language-xml>&lt;context:component-scan base-package=&quot;com.github.myth.*&quot;/&gt;
&lt;aop:aspectj-autoproxy expose-proxy=&quot;true&quot;/&gt;
&lt;bean id=&quot;mythTransactionBootstrap&quot; class=&quot;com.github.myth.core.bootstrap.MythTransactionBootstrap&quot;&gt;
 &lt;property name=&quot;repositorySuffix&quot; value=&quot;account-service&quot;/&gt;
 &lt;property name=&quot;serializer&quot; value=&quot;kryo&quot;/&gt;
 &lt;property name=&quot;coordinatorQueueMax&quot; value=&quot;5000&quot;/&gt;
 &lt;property name=&quot;coordinatorThreadMax&quot; value=&quot;8&quot;/&gt;
 &lt;property name=&quot;rejectPolicy&quot; value=&quot;Abort&quot;/&gt;
 &lt;property name=&quot;blockingQueueType&quot; value=&quot;Linked&quot;/&gt;
 &lt;property name=&quot;repositorySupport&quot; value=&quot;db&quot;/&gt;
 &lt;property name=&quot;mythDbConfig&quot;&gt;
     &lt;bean class=&quot;com.github.myth.common.config.MythDbConfig&quot;&gt;
         &lt;property name=&quot;url&quot;
                   value=&quot;jdbc:mysql://192.168.1.68:3306/myth?useUnicode=true&amp;amp;characterEncoding=utf8&quot;/&gt;
         &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
         &lt;property name=&quot;password&quot; value=&quot;Wgj@555888&quot;/&gt;
         &lt;property name=&quot;username&quot; value=&quot;xiaoyu&quot;/&gt;
     &lt;/bean&gt;
 &lt;/property&gt;
&lt;/bean&gt;
</code></pre></li><li><p>Add @Myth to the implementation method of springcloud service.</p></li><li><p>Listen to the message queue (message queue name written in the annotations method), invoke the framework provides MythMqReceiveService.processMessage() method. If you use JMS, you can refer to the Demo project for details.</p><pre><code class=language-java>@JmsListener(destination = &quot;account&quot;,containerFactory = &quot;queueListenerContainerFactory&quot;)
public void receiveQueue(byte[] message) {
  LOGGER.info(&quot;=========扣减账户信息接收到Myth框架传入的信息==========&quot;);
  final Boolean success = mythMqReceiveService.processMessage(message);
  if(success){
      //消费成功，消息出队列，否则不消费
  }
}
</code></pre><ul><li><p>In the springcloud consumer (the invoker of the transaction, the caller)</p></li><li><p>add myth-springcloud dependency</p><pre><code class=language-xml>&lt;dependency&gt;
&lt;groupId&gt;com.github.myth&lt;/groupId&gt;
&lt;artifactId&gt;myth-springcloud&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre></li></ul><ul><li><p>Set feignClient to add @Myth annotation to the interface, the target must be set to the service interface you actually call, and it must be set correctly.</p><pre><code class=language-java>@FeignClient(value = &quot;account-service&quot;, configuration = MyConfiguration.class)
public interface AccountClient {
          
   @Myth(destination = &quot;account&quot;, target = AccountService.class)
  Boolean payment(@RequestBody AccountDTO accountDO);
}
</code></pre><ul><li>FeignClient config: configuration = MyConfiguration.class
```java
@Configuration
public class MyConfiguration {</li></ul><p>@Bean
@Scope(&ldquo;prototype&rdquo;)
public Feign.Builder feignBuilder() {
return Feign.builder()
.requestInterceptor(new MythRestTemplateInterceptor())
.invocationHandlerFactory(invocationHandlerFactory());
}</p><p>@Bean
public InvocationHandlerFactory invocationHandlerFactory() {
return (target, dispatch) -&gt; {
MythFeignHandler handler = new MythFeignHandler();
handler.setTarget(target);
handler.setHandlers(dispatch);
return handler;
};
}
}
```</p></li><li><p>The MythTransactionBootstrap startup class can be configured in xml or @Bean. Please refer to the specific configuration:<a href=https://github.com/yu199195/myth/wiki/Configuration>configuration for details</a></p><pre><code class=language-xml>&lt;context:component-scan base-package=&quot;com.github.myth.*&quot;/&gt;
&lt;aop:aspectj-autoproxy expose-proxy=&quot;true&quot;/&gt;
&lt;bean id=&quot;mythTransactionBootstrap&quot; class=&quot;com.github.myth.core.bootstrap.MythTransactionBootstrap&quot;&gt;
&lt;property name=&quot;repositorySuffix&quot; value=&quot;account-service&quot;/&gt;
&lt;property name=&quot;serializer&quot; value=&quot;kryo&quot;/&gt;
&lt;property name=&quot;coordinatorQueueMax&quot; value=&quot;5000&quot;/&gt;
&lt;property name=&quot;coordinatorThreadMax&quot; value=&quot;8&quot;/&gt;
&lt;property name=&quot;rejectPolicy&quot; value=&quot;Abort&quot;/&gt;
&lt;property name=&quot;blockingQueueType&quot; value=&quot;Linked&quot;/&gt;
&lt;property name=&quot;needRecover&quot; value=&quot;true&quot;/&gt;
&lt;property name=&quot;scheduledDelay&quot; value=&quot;120&quot;/&gt;
&lt;property name=&quot;scheduledThreadMax&quot; value=&quot;4&quot;/&gt;
&lt;property name=&quot;repositorySupport&quot; value=&quot;db&quot;/&gt;
&lt;property name=&quot;mythDbConfig&quot;&gt;
  &lt;bean class=&quot;com.github.myth.common.config.MythDbConfig&quot;&gt;
      &lt;property name=&quot;url&quot;
                value=&quot;jdbc:mysql://192.168.1.68:3306/myth?useUnicode=true&amp;amp;characterEncoding=utf8&quot;/&gt;
      &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
      &lt;property name=&quot;password&quot; value=&quot;Wgj@555888&quot;/&gt;
      &lt;property name=&quot;username&quot; value=&quot;xiaoyu&quot;/&gt;
  &lt;/bean&gt;
&lt;/property&gt;
&lt;/bean&gt;
</code></pre><ul><li>Note: Please configure the automatic recovery strategy on the consumer side to prevent the message sending failure in extreme cases.
<code>xml
&lt;!-Set to true, show that the recovery strategy--&gt;
&lt;property name=&quot;needRecover&quot; value=&quot;true&quot;/&gt;
&lt;!--Scheduling delay time--&gt;
&lt;property name=&quot;scheduledDelay&quot; value=&quot;120&quot;/&gt;
&lt;!--The thread size of the scheduling thread--&gt;
&lt;property name=&quot;scheduledThreadMax&quot; value=&quot;4&quot;/&gt;</code></li></ul></li><li><p>Select your messaging middleware type to import different jar.</p></li><li><p>If you are using JMS (ActiveMQ), import the jar package and configure the ActiveMQSendServiceImpl.</p><pre><code class=language-xml>&lt;dependency&gt;
  &lt;groupId&gt;com.github.myth&lt;/groupId&gt;
  &lt;artifactId&gt;myth-jms&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><pre><code class=language-xml>&lt;bean id=&quot;activemqSendService&quot; class=&quot;com.github.myth.jms.service.ActivemqSendServiceImpl&quot;&gt;    
  &lt;property name=&quot;jmsTemplate&quot; ref=&quot;jmsTemplate&quot;/&gt;
&lt;/bean&gt;
</code></pre></li><li><p>If you are using RabbitMQ, import the jar package and configure the RabbitMQSendServiceImpl.</p></li></ul><pre><code class=language-xml>     &lt;dependency&gt;
         &lt;groupId&gt;com.github.myth&lt;/groupId&gt;
         &lt;artifactId&gt;myth-rabbitmq&lt;/artifactId&gt;
     &lt;/dependency&gt;
</code></pre><pre><code class=language-xml>     &lt;bean id=&quot;rabbitmqSendService&quot; class=&quot;com.github.myth.rabbitmq.service.RabbitmqSendServiceImpl&quot;&gt;
       &lt;property name=&quot;amqpTemplate&quot; ref=&quot;amqpTemplate&quot;/&gt;
    &lt;/bean&gt;
</code></pre><ul><li>If you are using Kafka, import the jar package and configure KafkasendServiceImpl.</li></ul><pre><code class=language-xml>     &lt;dependency&gt;
        &lt;groupId&gt;com.github.myth&lt;/groupId&gt;
        &lt;artifactId&gt;myth-kafka&lt;/artifactId&gt;
    &lt;/dependency&gt;
</code></pre><pre><code class=language-xml>   &lt;bean id=&quot;KafkaSendService&quot; class=&quot;com.github.myth.kafka.service.KafkaSendServiceImpl&quot; &gt;
      &lt;property name=&quot;kafkaTemplate&quot; ref=&quot;kafkaTemplate&quot;/&gt;
   &lt;/bean&gt;     
</code></pre><ul><li>If you are using RocketMQ, import the jar package and configure the RocketMQSendServiceImpl.</li></ul><pre><code class=language-xml>         &lt;dependency&gt;
            &lt;groupId&gt;com.github.myth&lt;/groupId&gt;
            &lt;artifactId&gt;myth-rocketmq&lt;/artifactId&gt;
         &lt;/dependency&gt;
</code></pre><p><pre><code class=language-xml>   &lt;bean id=&quot;rocketmqSendService&quot;   class=&quot;com.github.myth.rocketmq.service.RocketmqSendServiceImpl&quot;&gt;
     &lt;property name=&quot;defaultMQProducer&quot; ref=&quot;defaultMQProducer&quot;/&gt;
   &lt;/bean&gt;<br>
</code></pre></li></ul></li></ul></p></article><div class="wwads-cn wwads-horizontal" data-id=127 style=max-width:500px></div></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/dromara>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div><div><img class=qrcode-img src=/img/qrcode/zsxq.png><p class=qrcode-desc>Knowledge Planet</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>@dromara. org. All Rights Reserved</a></p></div></footer></body></html>